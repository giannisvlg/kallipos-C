# 7. Δείκτες

<i>Σύνοψη</i> Διευθύνσεις μνήμης μεταβλητών, μεταβλητές δείκτη, δείκτες και συναρτήσεις, κλήση με αναφορά, επιστροφή πολλών τιμών από συναρτήσεις μέσω δεικτών, δείκτες σε συναρτήσεις, πίνακες και δείκτες, δείκτες σε δείκτες, πίνακες ως ορίσματα συναρτήσεων, δείκτες και αλφαριθμητικά, δείκτες σε δομές.  

<i>Προαπαιτούμενη γνώση</i> Τύποι δεδομένων, είσοδος/έξοδος, δομές επιλογής και επανάληψης, συναρτήσεις, πίνακες, δομές.

## 7.1 Εμφάνιση διευθύνσεων μνήμης μεταβλητών

Κάθε μεταβλητή στη γλώσσα C βρίσκεται σε συγκεκριμένη θέση στη μνήμη του υπολογιστή. Αυτή η θέση είναι ένας ακέραιος αριθμός αυστηρά θετικός. Στην ουσία στον προγραμματισμό κάθε αναφορά σε μεταβλητή πάντοτε μεταφράζεται σε διευθύνσεις στη μνήμη. Η θέση αυτή ονομάζεται διεύθυνση και υπάρχει δυνατότητα να εντοπιστεί με τη χρήση του τελεστή <span class="p-style">&</span> όπως παρουσιάζεται και στον κώδικα 7.1. Σε αυτό το παράδειγμα στην πρώτη γραμμή εκτύπωσης εμφανίζονται οι τιμές των μεταβλητών <span class="p-style">x</span> και <span class="p-style">y</span> (οι τιμές 100 και 200 αντίστοιχα) και στη δεύτερη γραμμή οι θέσεις τους στη μνήμη του υπολογιστή. Παρατηρήστε ότι για να εκτυπωθούν οι διευθύνσεις μνήμης χρησιμοποιήθηκε ο προσδιοριστής διαμόρφωσης <span class="p-style">%p</span> και οι μεταβλητές που περιέχουν διευθύνσεις μνήμης μετατρέπονται σε <span class="p-style">void*</span> καθώς περνούν ως ορίσματα στην <span class="p-style">printf()</span>.

```{.c title="Κώδικας 7.1: ch7_p1.c - εμφάνιση διευθύνσεων μνήμης που καταλαμβάνουν δύο μεταβλητές." linenums="1"}
--8<-- "src/ch7_p1.c"
```

Στη συνέχεια παρουσιάζονται δύο διαφορετικές εκτελέσεις του ίδιου προγράμματος.

<div class="flex">
  <div>
    ```
    x=100 y=200.000000
    &x=0x16bc02e28 , &y=0x16bc02e20
    ```
  </div>
  <div>
    ```
    x=100 y=200.000000
    &x=0x16f7ab288 , &y=0x16f7ab2802
    ```
  </div>
</div>

Ένα ενδιαφέρον στοιχείο αυτού του μικρού προγράμματος είναι ότι δεν εκτυπώνει πάντα τις ίδιες διευθύνσεις, όπως παρατηρείται και στο παράδειγμα εκτέλεσης. Αυτό συμβαίνει καθώς ο μεταγλωττιστής δεν δεσμεύει πάντοτε την ίδια διεύθυνση μνήμης για κάθε μεταβλητή. 


## 7.2 Μεταβλητές δείκτη

Οι διευθύνσεις μνήμης μπορούν να εκχωρηθούν σε μεταβλητές ειδικού σκοπού που ονομάζονται δείκτες. Οι μεταβλητές αυτές δηλώνονται ως <span class="p-style">TYPE *VARIABLE</span>, όπου <span class="p-style">TYPE</span> ένας οποιοσδήποτε τύπος της γλώσσας (π.χ. <span class="p-style">int, double</span> κλπ.). Για παράδειγμα η δήλωση:

```{.c}
int *x;
```
δημιουργεί μια μεταβλητή δείκτη που δείχνει σε διευθύνσεις όπου θα αποθηκευτούν ακέραιες τιμές. Από την άλλη η δήλωση:

```{.c}
double *z;
```
δημιουργεί μια μεταβλητή δείκτη που δείχνει σε διευθύνσεις όπου μπορούν να τοποθετηθούν τιμές με δεκαδικά ψηφία. Ωστόσο, αν και οι δύο δείκτες έχουν διαφορετικό βασικό τύπο (<span class="p-style">int*</span> και <span class="p-style">double*</span> αντίστοιχα), στην πράξη και ο ένας δείκτης αλλά και ο άλλος θα έχουν το ίδιο μέγεθος σε bytes και θα μπορούν και οι δύο να αποθηκεύσουν διευθύνσεις. Αυτό φαίνεται και στο παράδειγμα του κώδικα 7.2, όπου εμφανίζεται στην οθόνη το μέγεθος σε bytes των δεικτών για δύο μεταβλητές διαφορετικού τύπου.


```{.c title="Κώδικας 7.2: ch7_p2.c - το μέγεθος των μεταβλητών δεικτών είναι ίδιο." linenums="1"}
--8<-- "src/ch7_p2.c"
```
Αν για παράδειγμα η εκτέλεση του προγράμματος γίνει σε ένα υπολογιστικό σύστημα 64bits, τότε είναι πολύ πιθανό να παραχθεί η ακόλουθη έξοδος:

```
Sizes of variables 4 and 8
Sizes of pointers 8 and 8
```
Το αποτέλεσμα υποδεικνύει ότι και στις δυο περιπτώσεις δεικτών θα χρειαστούν 8 bytes, μιας και τα συστήματα αρχιτεκτονικής 64bit χρησιμοποιούν διευθύνσεις μνήμης μεγέθους 64bits (8 bytes).  
Στο παράδειγμα του κώδικα 7.3 γίνεται ανάθεση διευθύνσεων μεταβλητών σε δείκτες και στη συνέχεια γίνεται εμφάνιση αυτών των διευθύνσεων.


```{.c title="Κώδικας 7.3: ch7_p3.c - ανάθεση διευθύνσεων μεταβλητών σε δείκτες." linenums="1"}
--8<-- "src/ch7_p3.c"
```
Μια πιθανή έξοδος κατά την εκτέλεση του προγράμματος είναι η ακόλουθη:

```
x=100 y=200.000000
&px=0x16d36ee28 &py=0x16d36ee20
```
Οι δείκτες μπορούν να χρησιμοποιηθούν για την απόδοση τιμών στις μεταβλητές στις οποίες δείχνουν, δηλαδή κάποιος μπορεί έμμεσα να αλλάξει την τιμή μιας μεταβλητής μέσω ενός δείκτη. Η διαδικασία αυτή ονομάζεται **αποαναφορά (dereference)**. Ένα σχετικό παράδειγμα παρουσιάζεται στον κώδικα 7.4 όπου πραγματοποιείται έμμεση αλλαγή της τιμή μιας μεταβλητής, χωρίς απευθείας πρόσβαση στην ίδια τη μεταβλητή, αλλά με αποαναφορά στον δείκτη που δείχνει σε αυτήν τη μεταβλητή.


```{.c title="Κώδικας 7.4: ch7_p4.c - αποαναφορά δείκτη." linenums="1"}
--8<-- "src/ch7_p4.c"
```

Η εκτέλεση του προγράμματος εμφανίζει:

```
x=100 y=200.000000
x=5 y=20.000000
```
## 7.3 Δείκτες και συναρτήσεις

### 7.3.1 Κλήση με αναφορά

Οι συναρτήσεις στη γλώσσα C τυπικά δέχονται ορίσματα με τιμή, δηλαδή απλά γίνεται ανάθεση της τιμής που περνά η καλούσα συνάρτηση στο όρισμα και τίποτα παραπάνω. Έστω το παράδειγμα του κώδικα 7.5.

```{.c title="Κώδικας 7.5: ch7_p5.c - κλήση με τιμή (call by value)." linenums="1"}
--8<-- "src/ch7_p5.c"
```
Σε αυτό το παράδειγμα η συνάρτηση <span class="p-style">main()</span> περνά την τιμή 100 στο όρισμα <span class="p-style">x</span> της συνάρτησης <span class="p-style">f()</span>. Η συνάρτηση αλλάζει το όρισμα και το εκτυπώνει και μετά επιστρέφει στη <span class="p-style">main()</span>. Η εκτέλεση του παραπάνω προγράμματος δίνει τα ακόλουθα αποτελέσματα:

```
MAIN(x)=100
F(x)=100
F(x)=101
MAIN(x)=100
```
Η συνάρτηση <span class="p-style">f()</span> όντως αλλάζει την τοπική μεταβλητή <span class="p-style">x</span> κατά 1, αλλά αυτή η αλλαγή δεν μεταφέρεται και στη μεταβλητή <span class="p-style">mainX</span> στη συνάρτηση <span class="p-style">main()</span>. Αυτό συμβαίνει διότι η μεταβλητή <span class="p-style">mainX</span> απλά αρχικοποίησε την τιμή του ορίσματος <span class="p-style">x</span> και οι αλλαγές που μετέπειτα γίνονται στη <span class="p-style">x</span> δεν μεταφέρονται στη <span class="p-style">mainX</span>. Το πρόγραμμα θα είχε ακριβώς την ίδια συμπεριφορά ακόμα και αν η συνάρτηση <span class="p-style">f()</span> καλούνταν με <span class="p-style">f(100)</span> αντί για την κλήση <span class="p-style">f(mainX)</span>. Για τον λόγο αυτό λέμε πως έγινε **κλήση με τιμή (call by value)**. Αν είναι επιθυμητό η συνάρτηση <span class="p-style">f()</span> να αλλάξει και την τιμή της <span class="p-style">mainX</span> υπάρχουν δύο επιλογές:

* Nα επιστρέφει την τιμή με return.
* Να γίνει κλήση με αναφορά.

Στην πρώτη περίπτωση θα πρέπει η συνάρτηση να έχει την εντολή <span class="p-style">return x</span> ως τελευταία εντολή έτσι ώστε επιστραφεί η τιμή στη <span class="p-style">main()</span>. Σε αυτήν την περίπτωση το πρόγραμμα θα λάβει τη μορφή που παρουσιάζεται στον κώδικα 7.6.

```{.c title="Κώδικας 7.6: ch7_p6.c - αλλαγή της τιμής της μεταβλητής mainX με εκχώρηση της τιμής που επιστρέφει η συνάρτηση f() στη mainX." linenums="1"}
--8<-- "src/ch7_p6.c"
```

Η συνάρτηση <span class="p-style">f()</span> επιστρέφει το όρισμα <span class="p-style">x</span> αλλαγμένο, επομένως και η <span class="p-style">main()</span> θα μπορέσει να το λάβει με επιστροφή τιμής. Η εκτέλεση του παραπάνω προγράμματος παρουσιάζεται στη συνέχεια:

```
MAIN(x)=100
F(x)=100
F(x)=101
MAIN(x)=101
```

Δεν είναι πάντα εφικτό να χρησιμοποιείται η τιμή επιστροφής μιας συνάρτησης για την αλλαγή της τιμής ενός ορίσματός της, επομένως πρέπει να βρεθεί κάποιος εναλλακτικός τρόπος επιστροφής τιμής από συνάρτηση. Σε αυτόν τον εναλλακτικό τρόπο, αντί να περνά η τιμή μιας μεταβλητής σε μια συνάρτηση, περνά ένας δείκτης προς τη διεύθυνση της μεταβλητής και η αλλαγή στην τιμή της μεταβλητής γίνεται με αποαναφορά. Αυτό το είδος περάσματος παραμέτρων ονομάζεται κλήση με αναφορά (call by reference). Η νέα μορφή του κώδικα παρουσιάζεται στον κώδικα 7.7. Σε αυτήν την περίπτωση η συνάρτηση <span class="p-style">f()</span> δέχεται ως όρισμα έναν δείκτη σε ακέραιο και όχι έναν ακέραιο όπως πριν. Ωστόσο, για να μπορέσει να αλλάξει την τιμή που δείχνει ο δείκτης πρέπει να γίνει αποαναφορά. Μετά την ολοκλήρωση της εκτέλεσης της συνάρτησης, η τιμή της <span class="p-style">mainX</span> θα έχει αλλάξει επίσης, καθώς η συνάρτηση <span class="p-style">f()</span> θα έχει αλλάξει το περιεχόμενο που έδειχνε ο δείκτης <span class="p-style">x</span> και όχι τον ίδιο τον δείκτη.


```{.c title="Κώδικας 7.7: ch7_p7.c - αλλαγή της τιμής της μεταβλητής mainX μέσα στη συνάρτηση f() με αποαναφορά." linenums="1"}
--8<-- "src/ch7_p7.c"
```

H εκτέλεση του προγράμματος με τη νέα αλλαγή θα εμφανίσει:

```
MAIN(x)=100
F(x)=100
F(x)=101
MAIN(x)=101
```

### 7.3.2 Επιστροφή πολλών τιμών από συνάρτηση

Με τη χρήση των δεικτών και τη δυνατότητα που δίνουν για έμμεση αναφορά σε μεταβλητές γίνεται εφικτή η επιστροφή παραπάνω από μια τιμών από μια συνάρτηση. Για παράδειγμα έστω ότι είναι επιθυμητό μια συνάρτηση να επιστρέφει μια τιμή από έναν υπολογισμό. Αυτό συμβαίνει στον κώδικα 7.8 όπου η συνάρτηση <span class="p-style">calc_min()</span> δέχεται ως όρισμα μια ακέραια τιμή <span class="p-style">n</span>, διαβάζει από το πληκτρολόγιο <span class="p-style">n</span> αριθμούς και επιστρέφει τον μικρότερο από αυτούς.

```{.c title="Κώδικας 7.8: ch7_p8.c - παράδειγμα συνάρτησης που επιστρέφει μια τιμή." linenums="1"}
--8<-- "src/ch7_p8.c"
```

Ωστόσο, αν είναι επιθυμητό η συνάρτηση να επιστρέψει ταυτόχρονα και το μέγιστο και το ελάχιστο των <span class="p-style">n</span> αριθμών, αυτό σημαίνει ότι θα πρέπει να οριστεί μια δομή με πεδία τα δύο αποτελέσματα και να επιστρέφεται από τη συνάρτηση μια εγγραφή αυτής της δομής. Ένας απλούστερος τρόπος είναι να πραγματοποιηθεί κλήση με αναφορά και η συνάρτηση να δεχθεί ως ορίσματα δύο δείκτες, με τον πρώτο να δείχνει στην ελάχιστη τιμή του πίνακα και τον δεύτερο στη μέγιστη τιμή, όπως συμβαίνει στον κώδικα 7.9. Ο δείκτης <span class="p-style">min</span> δείχνει προς την ελάχιστη τιμή και ο δείκτης <span class="p-style">max</span> στη μέγιστη. Για να επιστραφούν αυτές οι τιμές με αλλαγές, χρειάζεται να γίνει αποαναφορά δεικτών.


```{.c title="Κώδικας 7.9: ch7_p9.c - παράδειγμα συνάρτησης που επιστρέφει δύο τιμές μέσω των παραμέτρων της." linenums="1"}
--8<-- "src/ch7_p9.c"
```
Ένα άλλο παράδειγμα της ίδιας τεχνικής είναι και αυτό της συνάρτησης που αντιμεταθέτει μεταβλητές. Μια πρώτη προσπάθεια να γίνει αυτό παρουσιάζεται στον κώδικα 7.10.


```{.c title="Κώδικας 7.10: ch7_p10.c - λανθασμένος κώδικας συνάρτησης αντιμετάθεσης μεταβλητών." linenums="1"}
--8<-- "src/ch7_p10.c"
```
Προφανώς, ο παραπάνω κώδικας δεν πραγματοποιεί αντιμετάθεση, καθώς οι μεταβλητές περνούν στη συνάρτηση με τιμή και το μόνο που κάνει η συνάρτηση είναι να αντιμεταθέσει τις τοπικές μεταβλητές και όχι τα πραγματικά ορίσματα. Το πρόβλημα μπορεί να επιλυθεί με χρήση δεικτών όπως παρουσιάζεται στον κώδικα 7.11.

```{.c title="Κώδικας 7.11: ch7_p11.c - συνάρτηση που αντιμεταθέτει δύο ακέραιες μεταβλητές." linenums="1"}
--8<-- "src/ch7_p11.c"
```

### 7.3.3 Δείκτες σε συναρτήσεις

Ένας δείκτης σε συνάρτηση (function pointer) είναι μια ειδική περίπτωση δείκτη όπου ο δείκτης δεν δείχνει σε μια θέση μνήμης που περιέχει μια μεταβλητή, αλλά στο σημείο εκκίνησης μίας συνάρτησης. Ένα παράδειγμα που επιδεικνύει τη χρήση δεικτών σε συναρτήσεις βρίσκεται στον κώδικα 7.12. Στο παράδειγμα αυτό δημιουργείται ένας δείκτης σε συνάρτηση που δέχεται ως ορίσματα δύο ακέραιες τιμές και επιστρέφει μια ακέραια τιμή. Έτσι με έμμεση αναφορά στην αντίστοιχη συνάρτηση μπορεί να καλείται είτε η συνάρτηση <span class="p-style">add()</span> είτε η συνάρτηση <span class="p-style">sub()</span>.

```{.c title="Κώδικας 7.12: ch7_p12.c - δείκτης σε συνάρτηση." linenums="1"}
--8<-- "src/ch7_p12.c"
```

Ακολουθεί το αποτέλεσμα της εκτέλεσης του κώδικα:

```
Calling indirectly add() gives 300
Calling indirectly sub() gives 100
```

## 7.4 Πίνακες και δείκτες

Στη γλώσσα C υπάρχει μια σύνδεση ανάμεσα στους πίνακες και τους δείκτες και γενικά κάθε αναφορά σε δείκτη μπορεί να θεωρηθεί και αναφορά σε πίνακα όπως και το αντίστροφο. Για παράδειγμα οι δηλώσεις:

```{.c}
int x[5];
int *px = &x[0];
```

δημιουργούν έναν πίνακα ακεραίων με 5 συνεχόμενα στοιχεία στη μνήμη του υπολογιστή και αναθέτουν στον δείκτη <span class="p-style">px</span> τη διεύθυνση του πρώτου στοιχείου του πίνακα. Στα στοιχεία του πίνακα <span class="p-style">x</span> μπορεί να γίνει αναφορά με τον γνωστό τρόπο, δηλαδή <span class="p-style">x[0], x[1], x[2], x[3], x[4]</span> αλλά και με χρήση του δείκτη px, όπως φαίνεται και στον κώδικα 7.13.

```{.c title="Κώδικας 7.13: ch7_p13.c - δείκτης στο πρώτο στοιχείο πίνακα." linenums="1"}
--8<-- "src/ch7_p13.c"
```

Η αναφορά <span class="p-style">\*(px+1)</span> αφορά το δεύτερο στοιχείο του πίνακα και η αναφορά <span class="p-style">\*(px+2)</span> το τρίτο στοιχείο του πίνακα. Η έξοδος του προγράμματος είναι:

```
x[0]=1 x[1]=10 x[2]=100 x[3]=1000 x[4]=10000
*(0x16d6f2e14)=1 *(0x16d6f2e18)=10 *(0x16d6f2e1c)=100 *(0x16d6f2e20)=1000
    ↪ *(0x16d6f2e24)=10000
```

Οι δείκτες, αν και είναι κατά βάση ακέραιες μεταβλητές, αναφέρονται σε θέσεις μνήμης υπολογιστή και επομένως θα πρέπει να διαθέτουν και αντίστοιχους τελεστές. Στο παράδειγμα του κώδικα 7.14, παρουσιάζεται μια διαφορετική χρήση των μοναδιαίων τελεστών αύξησης και μείωσης. Στο παράδειγμα αυτό χρησιμοποιείται μια μεταβλητή χαρακτήρα, ένας δείκτης στη μεταβλητή χαρακτήρα, μια ακέραια μεταβλητή και ένας δείκτης στην ακέραια μεταβλητή. Οι μοναδιαίοι τελεστές <span class="p-style">++</span> και <span class="p-style">‐‐</span> δεν επιδρούν πάνω στις τιμές των μεταβλητών αλλά στις διευθύνσεις που δείχνουν οι δείκτες.

```{.c title="Κώδικας 7.14: ch7_p14.c - εφαρμογή τελεστών μοναδιαίας αύξησης και μοναδιαίας μείωσης σε μεταβλητές δεικτών." linenums="1"}
--8<-- "src/ch7_p14.c"
```
Μια ενδεικτική εκτέλεση δίνει τα ακόλουθα αποτελέσματα:

```
c=A i=100 p2c=0x16bd42e2b p2i=0x16bd42e1c
c=A i=100 p2c=0x16bd42e2c p2i=0x16bd42e20
c=A i=100 p2c=0x16bd42e2c p2i=0x16bd42e1c
```
H χρήση μοναδιαίων τελεστών αύξησης σε δείκτες δεν έχει τα ίδια αποτελέσματα όπως στην περίπτωση των ακέραιων μεταβλητών. Στους δείκτες κάθε αύξηση ή μείωση μετακινεί τον δείκτη στην επόμενη ή στην προηγούμενη θέση μνήμης αντίστοιχα. Στην περίπτωση των δεικτών σε χαρακτήρα αυτό σημαίνει ότι η μετακίνηση γίνεται κατά μια θέση, αφού οι μεταβλητές χαρακτήρα απαιτούν 1 byte για αποθήκευση, ενώ στην
περίπτωση των ακέραιων τιμών η μετακίνηση γίνεται κατά 4 θέσεις, εφόσον για κάθε ακέραιο απαιτούνται 4 bytes.  
  
Οι δείκτες μπορούν να χρησιμοποιηθούν για τη διάσχιση πίνακα μέσω των τελεστών μοναδιαίας αύξησης και μείωσης. Στο παράδειγμα του κώδικα 7.15 σκοπός είναι να βρεθεί στον πίνακα <span class="p-style">x</span> η θέση της τιμής που περιέχει η μεταβλητή <span class="p-style">element</span>. Για την αναζήτηση χρησιμοποιείται δείκτης που δείχνει αρχικά στο πρώτο στοιχείο του πίνακα. Σε κάθε επανάληψη, όσο η τιμή δεν έχει ακόμα εντοπιστεί, ο δείκτης πηγαίνει στο επόμενο στοιχείο του πίνακα με χρήση του μοναδιαίου τελεστή <span class="p-style">++</span>. Σε κάθε επανάληψη ο δείκτης <span class="p-style">px</span> μεταφέρεται στη διεύθυνση του επόμενου στοιχείου του πίνακα και με αποαναφορά γίνεται έλεγχος σχετικά με το εάν ο πίνακας περιέχει τη ζητούμενη τιμή.

```{.c title="Κώδικας 7.15: ch7_p15.c - διάσχιση πίνακα με δείκτη προς την αρχή του και εφαρμογή του τελεστή ++." linenums="1"}
--8<-- "src/ch7_p15.c"
```

### 7.4.1 Δείκτης σε δείκτη

Ένας δείκτης μπορεί να δείχνει και σε συνθετότερες δομές, όπως για παράδειγμα σε πίνακες, σε δομές, σε ενώσεις ή και σε άλλους δείκτες. Στο παράδειγμα του κώδικα 7.16 δημιουργείται ένας υποπίνακας από έναν αρχικό πίνακα.

```{.c title="Κώδικας 7.16: ch7_p16.c - «λήψη» ενός υποπίνακα με χρήση δεικτών." linenums="1"}
--8<-- "src/ch7_p16.c"
```

Η έξοδος του παραπάνω προγράμματος είναι:

```
Element at index 0 of the subarray has value 300
Element at index 1 of the subarray has value 400
```

Επιπλέον, ένας δείκτης μπορεί να δείξει και σε άλλο δείκτη, όπως φαίνεται και στο παράδειγμα του κώδικα 7.17.

```{.c title="Κώδικας 7.17: ch7_p17.c - δείκτης σε δείκτη." linenums="1"}
--8<-- "src/ch7_p17.c"
```

Ο δείκτης <span class="p-style">pt1</span> δείχνει στη διεύθυνση της ακέραιας μεταβλητής <span class="p-style">var</span> και ο δείκτης <span class="p-style">pt2</span> δείχνει στη διεύθυνση του δείκτη <span class="p-style">pt1</span>. Μετά την εκτέλεση του προγράμματος, μια ενδεικτική εκτύπωση θα είναι η ακόλουθη:

```
1: var=100 pt1=0x16d6e2e28 pt2=0x16d6e2e20
2: var=101 pt1=0x16d6e2e28 pt2=0x16d6e2e20
3: var=102 pt1=0x16d6e2e28 pt2=0x16d6e2e20
```

Η πρώτη γραμμή της εξόδου εμφανίζει την τιμή της μεταβλητής και τις διευθύνσεις που έχουν οι δείκτες. Η αποαναφορά <span class="p-style">\*pt1</span> επιστρέφει την τιμή 100 όπως είναι άλλωστε και η τιμή της var. Την ίδια τιμή θα επέστρεφε και η αποαναφορά του διπλού δείκτη <span class="p-style">\*\*pt2</span>. Συνεπώς, οι εντολές <span class="p-style">(\*pt1)++</span> και <span class="p-style">(\*\*pt2)++</span> προκαλούν αύξηση της τιμής που διατηρεί η μεταβλητή <span class="p-style">var</span> κατά ένα και έτσι προκύπτει η έξοδος στη δεύτερη και τρίτη γραμμή της εξόδου.  
Μια χρησιμότητα των δεικτών σε δείκτη εντοπίζεται στις περιπτώσεις συναρτήσεων που είναι επιθυμητή η αλλαγή ενός δείκτη και όχι του περιεχομένου του, όπως παρουσιάζεται στο παράδειγμα του κώδικα 7.18 όπου η συνάρτηση <span class="p-style">try1()</span> και η συνάρτηση <span class="p-style">try2()</span> στοχεύουν στο να αλλάξουν έμμεσα την τιμή που βρίσκεται στη θέση 3 του πίνακα.

```{.c title="Κώδικας 7.18: ch7_p18.c - αλλαγή ενός δείκτη που περνά ως όρισμα σε μια συνάρτηση." linenums="1"}
--8<-- "src/ch7_p18.c"
```
Η έξοδος του προγράμματος είναι:

```
pt1=0x16b5df068 , pt2=0x16b5df068
BEFORE x=0x16b5df068
AFTER x=0x16b5df06c
0x16b5df060=10 0x16b5df064=20 0x16b5df068=31 0x16b5df06c=40 0x16b5df070=50
0x16b5df060=10 0x16b5df064=20 0x16b5df068=31 0x16b5df06c=41 0x16b5df070=50
pt1=0x16b5df068 , pt2=0x16b5df06c
```
Όπως είναι φανερό, μόνο η συνάρτηση <span class="p-style">try2()</span> που δέχεται δείκτη σε δείκτη μπορεί να αλλάξει την ίδια την τιμή του δείκτη.

### 7.4.2 Πέρασμα πινάκων σε συναρτήσεις

Οι δείκτες μπορούν να χρησιμοποιηθούν για το πέρασμα πινάκων σε συναρτήσεις. Στο παράδειγμα του κώδικα 7.19, τα στοιχεία ενός πίνακα αλλάζουν μέσα σε μια συνάρτηση.

```{.c title="Κώδικας 7.19: ch7_p19.c - τροποποίηση στοιχείων πίνακα που περνά ως όρισμα σε συνάρτηση." linenums="1"}
--8<-- "src/ch7_p19.c"
```
Η έξοδος του προγράμματος είναι:

```
100 200 100 200 100
```
Η αλλαγή στις τιμές έγινε με χρήση του μοναδιαίου τελεστή αύξησης. Η συνάρτηση <span class="p-style">modify_table()</span> μπορεί να γραφεί και απλούστερα, όπως παρουσιάζεται στον κώδικα 7.20, όπου δεν χρειάζεται πλέον η διαδικασία της αποαναφοράς που παρουσιάστηκε προηγουμένως. Παρατηρήστε ότι η αποαναφορά <span class="p-style">*(x+i)</span> είναι ισοδύναμη με τον κώδικα <span class="p-style">x[i]</span>.

```{.c title="Κώδικας 7.20: ch7_p20.c - τροποποίηση στοιχείων πίνακα μέσω συνάρτησης." linenums="1"}
--8<-- "src/ch7_p20.c"
```
Η έξοδος είναι ίδια όπως και στο προηγούμενο παράδειγμα.  
Μια συνάρτηση μπορεί να χρησιμοποιηθεί ώστε να επιστρέψει πολλαπλές τιμές ως πεδία ενός πίνακα. Για παράδειγμα αν θέλουμε μια συνάρτηση να επιστρέφει την ελάχιστη τιμή, τη μέγιστη τιμή και τον μέσο όρο των τιμών ενός πίνακα, αυτό μπορεί να γίνει με χρήση 3 δεικτών, έναν για κάθε αποτέλεσμα. Ωστόσο, το ίδιο μπορεί να γίνει και με πίνακα όπως παρουσιάζεται στον κώδικα 7.21. Στη συνάρτηση <span class="p-style">get_stats()</span> το στοιχείο του πίνακα <span class="p-style">stats[0]</span> χρησιμοποιείται για την αποθήκευση της ελάχιστης τιμής, το <span class="p-style">stats[1]</span> για αποθήκευση της μέγιστης τιμής και το <span class="p-style">stats[2]</span> για αποθήκευση του μέσου όρου.

```{.c title="Κώδικας 7.21: ch7_p21.c - επιστροφή πολλών αποτελεσμάτων από συνάρτηση με χρήση ενός ορίσματος πίνακα." linenums="1"}
--8<-- "src/ch7_p21.c"
```

Ωστόσο, η ανάγκη απομνημόνευσης της σειράς που είναι αποθηκευμένα τα αποτελέσματα στον πίνακα προκαλεί δυσκολία στην κατανόηση του κώδικα. Στον κώδικα 7.22 παρουσιάζεται μια ισοδύναμη υλοποίηση που χρησιμοποιεί κατάλληλα ονοματισμένους δείκτες τοπικής εμβέλειας. Η ανάθεση τιμών στους βοηθητικούς δείκτες πραγματοποιείται στη γραμμή 6 του κώδικα.

```{.c title="Κώδικας 7.22: ch7_p22.c - χρήση δεικτών τοπικής εμβέλειας για ευανάγνωστο κώδικα." linenums="1"}
--8<-- "src/ch7_p22.c"
```

### 7.4.3 Δείκτες και αλφαριθμητικά

Τα αλφαριθμητικά είναι και αυτά πίνακες και επομένως όσα έχουν αναφερθεί μέχρι στιγμής για τη σχέση δεικτών και πινάκων ισχύουν και για τα αλφαριθμητικά με την επιπλέον σημείωση πως στο τέλος των αλφαριθμητικών πρέπει να υπάρχει πάντα ο χαρακτήρας τερματισμού <span class="p-style">'\0'</span>. Στο παράδειγμα του κώδικα 7.23 πραγματοποιείται αρχικοποίηση αλφαριθμητικών με χρήση δεικτών. Το αλφαριθμητικό <span class="p-style">s1</span> είναι στατικό και η ανάθεση τιμής σε αυτό γίνεται στη συνέχεια με τη συνάρτηση <span class="p-style">strcpy()</span>. Το αλφαριθμητικό <span class="p-style">s2</span> αρχικοποιείται με ανάθεση τιμής κατά τη δήλωσή του. Το αλφαριθμητικό <span class="p-style">s3</span> είναι δείκτης που δείχνει σε μια δεσμευμένη περιοχή μνήμης όπου υπάρχουν οι χαρακτήρες της ακολουθίας.

```{.c title="Κώδικας 7.23: ch7_p23.c - αναθέσεις τιμών σε αλφαριθμητικά." linenums="1"}
--8<-- "src/ch7_p23.c"
```

Οι δείκτες μπορούν να χρησιμοποιηθούν και για το πέρασμα αλφαριθμητικών ως ορισμάτων σε συναρτήσεις. Στον κώδικα 7.24 η συνάρτηση <span class="p-style">find_digits()</span> επιστρέφει το πλήθος των χαρακτήρων ενός αλφαριθμητικού που είναι ψηφία. Η διαφορά με τις συναρτήσεις με ορίσματα πίνακες είναι πως στα αλφαριθμητικά δεν χρειάζεται να περάσει ως όρισμα το μήκος του αλφαριθμητικού, αφού αυτό υποδηλώνεται από το <span class="p-style">'\0'</span> ή εναλλακτικά μπορεί να υπολογιστεί με τη συνάρτηση <span class="p-style">strlen()</span> του <span class="p-style">string.h</span>.

```{.c title="Κώδικας 7.24: ch7_p24.c - εύρεση του πλήθους των ψηφίων που βρίσκονται σε ένα αλφαριθμητικό." linenums="1"}
--8<-- "src/ch7_p24.c"
```

Ισοδύναμη συνάρτηση με τη <span class="p-style">strlen()</span> μπορεί να γραφεί εύκολα κάνοντας χρήση αριθμητικής δεικτών, όπως φαίνεται στον κώδικα 7.25.

```{.c title="Κώδικας 7.25: ch7_p25.c - συνάρτηση εύρεσης του μήκους ενός αλφαριθμητικού." linenums="1"}
--8<-- "src/ch7_p25.c"
```

## 7.5 Δείκτης σε δομή

Ένας δείκτης μπορεί να χρησιμοποιηθεί ακόμα και για να δείξει σε μια μεταβλητή δομής. Στο παράδειγμα του κώδικα 7.26 ένας δείκτης δείχνει σε μια δομή για πρόσωπα και με αποαναφορά πραγματοποιεί τροποποίηση των στοιχείων της δομής. Η αποαναφορά ενός δείκτη προς μία δομή προκειμένου να πραγματοποιηθεί πρόσβαση σε ένα πεδίο της δομής γίνεται με δύο τρόπους: με τον τελεστή τελείας, όπως στο παράδειγμα
<span class="p-style">(\*pt).name</span> και εναλλακτικά με τον τελεστή <span class="p-style">‐></span> όπως στο παράδειγμα <span class="p-style">pt‐>name</span>. Και στις δύο περιπτώσεις που αναφέρθηκαν γίνεται αποαναφορά του δείκτη για πρόσβαση στο πεδίο <span class="p-style">name</span> της δομής. 

```{.c title="Κώδικας 7.26: ch7_p26.c - δείκτης σε δομή και πρόσβαση στα πεδία της δομής." linenums="1"}
--8<-- "src/ch7_p26.c"
```

Μια ενδεικτική εκτέλεση του προγράμματος δίνει τα ακόλουθα αποτελέσματα:

```
The pointer 0x16b0a2d4c points to a 'person'
Each 'person' occupies 204 bytes
Id: 1000, name: Ioannis , last name: Pappas
```

## 7.6 Δείκτες και πίνακες

Οι πίνακες και οι δείκτες είναι σχετικές μεταξύ τους έννοιες άλλα όχι ταυτόσημες. Το όνομα ενός πίνακα είναι η διεύθυνση προς το πρώτο στοιχείο του πίνακα. Αυτό σημαίνει ότι, για παράδειγμα, για έναν πίνακα με όνομα <span class="p-style">a</span>, πέντε ακεραίων, το <span class="p-style">a</span> δείχνει στο πρώτο στοιχείο του πίνακα, δηλαδή στο <span class="p-style">a[0]</span>. Συνεπώς, οι δύο τρόποι διάσχισης ενός πίνακα που παρουσιάζονται στον κώδικα 7.27 επιτυγχάνουν το ίδιο αποτέλεσμα.

```{.c title="Κώδικας 7.27: ch7_p27.c - διάσχιση πίνακα με δύο τρόπους." linenums="1"}
--8<-- "src/ch7_p27.c"
```

Η έξοδος του προγράμματος είναι η ακόλουθη:

```
Using array indexing:
1 2 3 4 5
Using array pointer arithmetic:
1 2 3 4 5
```

Ωστόσο, οι πίνακες και οι δείκτες έχουν και διαφορές. Για παράδειγμα η χρήση του τελεστή <span class="p-style">sizeof</span> σε δείκτη θα επιστρέψει το πλήθος των bytes που απαιτούνται για διευθυνσιοδότηση της μνήμης (π.χ. 8 bytes σε συστήματα αρχιτεκτονικής 64 bit), ενώ για έναν πίνακα θα επιστρέψει το συνολικό μέγεθος σε bytes του πίνακα. Ο κώδικας 7.28 δείχνει αυτήν τη διαφορά και ότι μπορεί να γίνει διάσχιση ενός πίνακα χρησιμοποιώντας έναν δείκτη προς το πρώτο στοιχείο του πίνακα και αριθμητική δεικτών για μετακίνηση από ένα στοιχείο του πίνακα στο επόμενο.

```{.c title="Κώδικας 7.28: ch7_p28.c - μερικές διαφορές δεικτών και πινάκων." linenums="1"}
--8<-- "src/ch7_p28.c"
```

Η έξοδος του προγράμματος είναι η ακόλουθη:

```
Size of array (arr) = 20 bytes
Size of pointer (ptr) = 8 bytes

Using array indexing:
arr[0] = 1
arr[1] = 2
arr[2] = 3
arr[3] = 4
arr[4] = 5

Using pointer:
*(ptr + 0) = 1
*(ptr + 1) = 2
*(ptr + 2) = 3
*(ptr + 3) = 4
*(ptr + 4) = 5

After incrementing pointer:
First element pointed by ptr = 2
First element of array = 1
```

Επίσης, στη γραμμή 20 έχει τοποθετηθεί σε σχόλια μια εντολή αλλαγής της διεύθυνσης που περιέχει το όνομα του πίνακα, κάτι το οποίο δεν επιτρέπεται. Αν η γραμμή 20 συμπεριληφθεί χωρίς σχόλιο, τότε ο μεταγλωττιστής θα εμφανίσει ένα μήνυμα λάθους της μορφής:

```
ch7_p28.c:24:8: error: cannot increment value of type 'int[5]'
    arr++; // Δεν γίνεται δεκτό από τον μεταγλωττιστή
    ~~~^
1 error generated.
```

Ένα ακόμα λεπτό σημείο που αφορά τη σχέση δεικτών και πινάκων είναι το λεγόμενο “decay to pointer” («αποσύνθεση» πίνακα σε δείκτη) και έχει να κάνει με το πέρασμα πινάκων σε συναρτήσεις. Ο κώδικας 7.29 δείχνει ότι στη <span class="p-style">main()</span> το μέγεθος του πίνακα είναι το πραγματικό μέγεθός του σε bytes. Ωστόσο, μόλις o πίνακας περάσει ως όρισμα στη συνάρτηση <span class="p-style">print_array_size()</span>, το μέγεθος του πίνακα πλέον είναι το μέγεθος ενός δείκτη. Αυτό δείχνει πως ο πίνακας «αποσυντίθεται» σε δείκτη όταν περνά ως όρισμα σε μια συνάρτηση.


```{.c title="Κώδικας 7.29: ch7_p29.c - αποσύνθεση πίνακα σε δείκτη." linenums="1"}
--8<-- "src/ch7_p29.c"
```

```
Outside function: Array size = 20 bytes
Inside function: Array size = 8 bytes
Array elements: 1 2 3 4 5
```

## 7.7 Ασκήσεις

***Άσκηση 1***  
Να γραφεί συνάρτηση <span class="p-style">int last_found(int *x, int n, int element)</span> που βρίσκει και επιστρέφει την τελευταία εμφάνιση του <span class="p-style">element</span> στον πίνακα <span class="p-style">n</span> στοιχείων, <span class="p-style">x</span>. Αν το στοιχείο <span class="p-style">element</span> δεν βρεθεί τότε η συνάρτηση να επιστρέφει την τιμή -1

??? tip "Λύση άσκησης 1"
    ```{.c linenums="1"}
    --8<-- "src/ch7_e1.c"
    ```

***Άσκηση 2***  
Nα γραφεί συνάρτηση <span class="p-style">int from_binary(char *s)</span>. Η συνάρτηση να λαμβάνει ως όρισμα το αλφαριθμητικό <span class="p-style">s</span> που μπορεί να θεωρηθεί ότι περιέχει μόνο δυαδικά ψηφία (0,1) και να επιστρέφει την ισοδύναμη τιμή του στο δεκαδικό σύστημα, π.χ. αν <span class="p-style">s="1110"</span>, θα πρέπει να επιστρέψει 14.

??? tip "Λύση άσκησης 2"
    ```{.c linenums="1"}
    --8<-- "src/ch7_e2.c"
    ```

***Άσκηση 3***  
Γράψτε μια συνάρτηση με όνομα <span class="p-style">reverse_array</span> που να αντιστρέφει ένα τμήμα ενός πίνακα. Η συνάρτηση να έχει ως πρωτότυπο το <span class="p-style">void reverse_array(int\* start, int\* end)</span> και να αντιστρέφει το τμήμα του πίνακα από το στοιχείο του πίνακα στο οποίο δείχνει ο δείκτης <span class="p-style">start</span> μέχρι και το στοιχείο που δείχνει ο δείκτης <span class="p-style">end</span>. Γράψτε ένα πρόγραμμα που να επιδεικνύει τη λειτουργία της συνάρτησης εκτυπώνοντας έναν πίνακα πριν και μετά την κλήση της.

??? tip "Λύση άσκησης 3"
    ```{.c linenums="3"}
    --8<-- "src/ch7_e3.c"
    ```

***Άσκηση 4***  
Κατασκευάστε ένα πρόγραμμα που διαχειρίζεται τις βαθμολογίες των φοιτητών σε ένα μάθημα. Για κάθε φοιτητή, θα πρέπει να αποθηκεύεται το όνομά του, ο αριθμός μητρώου και ο βαθμός του στο μάθημα. Ορίστε μια δομή <span class="p-style">student</span> που θα περιέχει τις παραπάνω πληροφορίες. Ορίστε μια δομή <span class="p-style">course</span> που θα περιέχει έναν πίνακα (με μέγιστο μέγεθος 100) από εγγραφές της δομής <span class="p-style">student</span>, και το πλήθος των φοιτητών που έχουν λάβει βαθμολογία στο μάθημα. Προσθέστε τις εξής λειτουργίες: 

1. Προσθήκη βαθμολογίας για έναν φοιτητή.
2. Αφαίρεση βαθμολογίας φοιτητή με βάση έναν αριθμό μητρώου. Αν ο αριθμός μητρώου βρεθεί τότε ο βαθμός του φοιτητή να γίνεται μηδέν.
3. Εκτύπωση όλων των βαθμολογιών των φοιτητών του μαθήματος.

??? tip "Λύση άσκησης 4"
    ```{.c linenums="1"}
    --8<-- "src/ch7_e4.c"
    ```
